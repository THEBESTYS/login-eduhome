<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ | ë”ë² ìŠ¤íŠ¸ì–´í•™ì›</title>
    
    <!-- Firebase SDK v8 (ê¸°ì¡´ thebestì™€ ë™ì¼í•œ ë²„ì „) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    
    <style>
        /* ë”ë² ìŠ¤íŠ¸ì–´í•™ì› í…Œë§ˆì— ë§ëŠ” ë””ìì¸ */
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #e74c3c;
            --accent: #f39c12;
            --accent-dark: #e67e22;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray-light: #f8f9fa;
            --gray: #6c757d;
            --gray-dark: #343a40;
            --success: #27ae60;
            --warning: #f1c40f;
            --danger: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Nanum Gothic', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--dark) 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .login-container {
            width: 100%;
            max-width: 440px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--dark));
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .logo-icon {
            font-size: 36px;
            color: var(--accent);
        }
        
        .logo-text {
            font-size: 28px;
            font-weight: 700;
        }
        
        .logo-text span {
            color: var(--accent);
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        .tabs {
            display: flex;
            background: var(--light);
            border-bottom: 1px solid #ddd;
        }
        
        .tab-button {
            flex: 1;
            padding: 20px 0;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tab-button:hover {
            color: var(--dark);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .tab-button.active {
            color: var(--primary);
        }
        
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 20%;
            right: 20%;
            height: 3px;
            background: var(--accent);
            border-radius: 3px 3px 0 0;
        }
        
        .form-panel {
            padding: 35px 30px;
            display: none;
        }
        
        .form-panel.active {
            display: block;
            animation: slideIn 0.4s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .form-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 25px;
            text-align: center;
        }
        
        .form-subtitle {
            font-size: 14px;
            color: var(--gray);
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            font-size: 15px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .input-label.required::after {
            content: ' *';
            color: var(--danger);
        }
        
        .input-field {
            width: 100%;
            padding: 14px 16px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            color: var(--dark);
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .input-field.error {
            border-color: var(--danger);
        }
        
        .input-field.success {
            border-color: var(--success);
        }
        
        .input-field::placeholder {
            color: #aaa;
        }
        
        .field-note {
            display: block;
            font-size: 13px;
            color: var(--gray);
            margin-top: 6px;
            line-height: 1.4;
        }
        
        .field-error {
            display: block;
            font-size: 13px;
            color: var(--danger);
            margin-top: 6px;
            display: none;
        }
        
        .submit-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .submit-button:hover {
            background: linear-gradient(135deg, var(--accent-dark), #d35400);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.3);
        }
        
        .submit-button:active {
            transform: translateY(0);
        }
        
        .submit-button.loading {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .links {
            text-align: center;
            margin-top: 25px;
            font-size: 14px;
            color: var(--gray);
        }
        
        .links a {
            color: var(--primary);
            text-decoration: none;
            margin: 0 10px;
            transition: color 0.3s ease;
            font-weight: 500;
        }
        
        .links a:hover {
            color: var(--primary-dark);
            text-decoration: underline;
        }
        
        .checkbox-group {
            margin-bottom: 20px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .checkbox-input {
            margin-top: 3px;
            margin-right: 12px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
            cursor: pointer;
        }
        
        .checkbox-label {
            font-size: 14px;
            color: var(--gray-dark);
            line-height: 1.5;
            cursor: pointer;
        }
        
        .checkbox-label a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .checkbox-label a:hover {
            text-decoration: underline;
        }
        
        .terms-section {
            background: var(--light);
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .terms-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 15px;
        }
        
        hr {
            border: none;
            height: 1px;
            background: #ddd;
            margin: 15px 0;
        }
        
        /* ìƒíƒœ ë©”ì‹œì§€ */
        .status-message {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
            text-align: center;
        }
        
        .status-success {
            background: #d5edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
            display: block;
        }
        
        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* í‘¸í„° */
        .footer {
            text-align: center;
            padding: 20px;
            background: var(--light);
            border-top: 1px solid #ddd;
            font-size: 13px;
            color: var(--gray);
        }
        
        .footer a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 480px) {
            .login-container {
                border-radius: 10px;
            }
            
            .form-panel {
                padding: 25px 20px;
            }
            
            .header {
                padding: 20px 15px;
            }
            
            .logo-text {
                font-size: 24px;
            }
            
            .tab-button {
                font-size: 15px;
                padding: 15px 0;
            }
            
            .form-title {
                font-size: 20px;
            }
        }
        
        /* ë¦¬ë””ë ‰ì…˜ ì•ˆë‚´ ë©”ì‹œì§€ */
        .redirect-message {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            text-align: center;
        }
        
        .redirect-target {
            font-weight: bold;
            color: var(--primary);
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="login-container">
        <!-- í—¤ë” -->
        <div class="header">
            <div class="logo">
                <i class="fas fa-graduation-cap logo-icon"></i>
                <div class="logo-text">
                    <span>THE BEST</span> ì–´í•™ì›
                </div>
            </div>
            <p>ì˜ì–´ êµìœ¡ì˜ ìƒˆë¡œìš´ ê¸°ì¤€</p>
        </div>
        
        <!-- ë¦¬ë””ë ‰ì…˜ ë©”ì‹œì§€ -->
        <div id="redirectMessage" class="redirect-message" style="display: none;">
            ë¡œê·¸ì¸ í›„ <span class="redirect-target" id="redirectTarget"></span> í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.
        </div>
        
        <!-- íƒ­ ë©”ë‰´ -->
        <div class="tabs">
            <button class="tab-button active" data-tab="login">ë¡œê·¸ì¸</button>
            <button class="tab-button" data-tab="signup">íšŒì›ê°€ì…</button>
        </div>
        
        <!-- ë¡œê·¸ì¸ í¼ -->
        <div id="login-form" class="form-panel active">
            <h2 class="form-title">ë¡œê·¸ì¸</h2>
            <p class="form-subtitle">ë”ë² ìŠ¤íŠ¸ì–´í•™ì› ìˆ˜ê°•ê´€ë¦¬ ì‹œìŠ¤í…œì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</p>
            
            <!-- ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="login-status" class="status-message"></div>
            
            <div class="input-group">
                <label class="input-label required" for="email">ì´ë©”ì¼</label>
                <input type="email" id="email" class="input-field" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                <div class="field-error" id="email-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label required" for="password">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="password" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                <div class="field-error" id="password-error"></div>
            </div>
            
            <button class="submit-button" id="login-btn">
                ë¡œê·¸ì¸
            </button>
            
            <div class="links">
                <a href="#" id="forgot-password">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
                <a href="#" data-tab="signup">íšŒì›ê°€ì…</a>
            </div>
        </div>
        
        <!-- íšŒì›ê°€ì… í¼ -->
        <div id="signup-form" class="form-panel">
            <h2 class="form-title">íšŒì›ê°€ì…</h2>
            <p class="form-subtitle">ë”ë² ìŠ¤íŠ¸ì–´í•™ì› íšŒì›ìœ¼ë¡œ ê°€ì…í•˜ê³  ëª¨ë“  ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ë³´ì„¸ìš”</p>
            
            <!-- ìƒíƒœ ë©”ì‹œì§€ -->
            <div id="signup-status" class="status-message"></div>
            
            <div class="input-group">
                <label class="input-label required" for="signup-email">ì´ë©”ì¼</label>
                <input type="email" id="signup-email" class="input-field" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                <div class="field-error" id="signup-email-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label required" for="username">ì´ë¦„</label>
                <input type="text" id="username" class="input-field" placeholder="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
                <div class="field-error" id="username-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label required" for="signup-password">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="signup-password" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
                <span class="field-note">ìµœì†Œ 6ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”</span>
                <div class="field-error" id="signup-password-error"></div>
            </div>
            
            <div class="input-group">
                <label class="input-label required" for="confirm-password">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" id="confirm-password" class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”">
                <div class="field-error" id="confirm-password-error"></div>
            </div>
            
            <!-- ì•½ê´€ ë™ì˜ -->
            <div class="terms-section">
                <div class="terms-title">ì•½ê´€ ë™ì˜</div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-all" class="checkbox-input">
                    <label for="terms-all" class="checkbox-label"><strong>ëª¨ë“  ì•½ê´€ì— ë™ì˜í•©ë‹ˆë‹¤</strong></label>
                </div>
                
                <hr>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-age" class="checkbox-input term" required>
                    <label for="terms-age" class="checkbox-label">ë§Œ 14ì„¸ ì´ìƒì…ë‹ˆë‹¤. (í•„ìˆ˜)</label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-service" class="checkbox-input term" required>
                    <label for="terms-service" class="checkbox-label">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë™ì˜ (í•„ìˆ˜) <a href="#" id="view-service-terms">ë³´ê¸°</a></label>
                </div>
                
                <div class="checkbox-item">
                    <input type="checkbox" id="terms-privacy" class="checkbox-input term" required>
                    <label for="terms-privacy" class="checkbox-label">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜ (í•„ìˆ˜) <a href="#" id="view-privacy-terms">ë³´ê¸°</a></label>
                </div>
            </div>
            
            <button class="submit-button" id="signup-btn">
                íšŒì›ê°€ì…
            </button>
            
            <div class="links">
                ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a href="#" data-tab="login">ë¡œê·¸ì¸</a>
            </div>
        </div>
        
        <!-- í‘¸í„° -->
        <div class="footer">
            <p>ë”ë² ìŠ¤íŠ¸ì–´í•™ì› | ì¸ì²œ ì—°ìˆ˜êµ¬ ì»¨ë²¤ì‹œì•„ëŒ€ë¡œ 230ë²ˆê¸¸ 42 ì•„ë¼í”„ë¼ì 2ì¸µ 207-1</p>
            <p>ì „í™”: 032-252-9600 | ì´ë©”ì¼: gcha3514@naver.com</p>
            <p><a href="https://thebestys.github.io/thebest/" target="_blank">ë©”ì¸ í™ˆí˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a></p>
        </div>
    </div>

    <script>
        // ========== Firebase ì„¤ì • (thebestì™€ ë™ì¼) ==========
        const firebaseConfig = {
            apiKey: "AIzaSyCLg04u_zdp27A8hKotF8DIZp5sH8vwFdE",
            authDomain: "login-57c14.firebaseapp.com",
            projectId: "login-57c14",
            storageBucket: "login-57c14.appspot.com",
            messagingSenderId: "568290041777",
            appId: "1:568290041777:web:6f70ed0ef606364856a2cc",
            measurementId: "G-H5KJ2R3LCK"
        };

        // ========== ì „ì—­ ë³€ìˆ˜ ==========
        let currentUser = null;
        let redirectUrl = null;
        
        // ========== í˜ì´ì§€ ì´ˆê¸°í™” ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log("ğŸ“„ login-eduhome í˜ì´ì§€ ë¡œë“œë¨");
            
            // 1. Firebase ì´ˆê¸°í™”
            initializeFirebase();
            
            // 2. URL íŒŒë¼ë¯¸í„°ì—ì„œ ë¦¬ë””ë ‰ì…˜ URL í™•ì¸
            checkRedirectUrl();
            
            // 3. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
            setupEventListeners();
            
            // 4. ë¡œê·¸ì¸ í¼ ì´ë©”ì¼ í•„ë“œì— í¬ì»¤ìŠ¤
            document.getElementById('email').focus();
            
            console.log("âœ… í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ");
        });
        
        // ========== Firebase ì´ˆê¸°í™” ==========
        function initializeFirebase() {
            try {
                console.log("ğŸ”¥ Firebase ì´ˆê¸°í™” ì‹œë„...");
                
                // Firebase ì´ˆê¸°í™”
                firebase.initializeApp(firebaseConfig);
                console.log("âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ");
                
                // í˜„ì¬ ì¸ì¦ ìƒíƒœ í™•ì¸
                firebase.auth().onAuthStateChanged((user) => {
                    currentUser = user;
                    if (user) {
                        console.log("âœ… ì´ë¯¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì:", user.email);
                        
                        // ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš° ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™
                        if (!redirectUrl) {
                            redirectToMainPage();
                        }
                    } else {
                        console.log("ğŸšª ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì—†ìŒ");
                    }
                });
                
            } catch (error) {
                console.error("âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:", error);
                showStatus('login', 'ì‹œìŠ¤í…œ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            }
        }
        
        // ========== ë¦¬ë””ë ‰ì…˜ URL í™•ì¸ ==========
        function checkRedirectUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const redirectParam = urlParams.get('redirect');
            
            if (redirectParam) {
                redirectUrl = decodeURIComponent(redirectParam);
                console.log("ğŸ”„ ë¦¬ë””ë ‰ì…˜ URL ê°ì§€ë¨:", redirectUrl);
                
                // ë¦¬ë””ë ‰ì…˜ ë©”ì‹œì§€ í‘œì‹œ
                const messageElement = document.getElementById('redirectMessage');
                const targetElement = document.getElementById('redirectTarget');
                
                if (messageElement && targetElement) {
                    // í˜ì´ì§€ ì´ë¦„ ì¶”ì¶œ
                    let pageName = "ì›í•˜ëŠ”";
                    if (redirectUrl.includes('memberadmin')) pageName = "ìˆ˜ê°•ê´€ë¦¬";
                    else if (redirectUrl.includes('reservation')) pageName = "ì˜ˆì•½";
                    else if (redirectUrl.includes('payment')) pageName = "ìˆ˜ê°•ë£Œ";
                    
                    targetElement.textContent = pageName;
                    messageElement.style.display = 'block';
                }
            }
        }
        
        // ========== ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™ ==========
        function redirectToMainPage() {
            console.log("ğŸ  ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤...");
            
            // 1. ë¶€ëª¨ ì°½ì—ê²Œ ë¡œê·¸ì¸ ì„±ê³µ ë©”ì‹œì§€ ì „ì†¡ (ë©”ì¸í˜ì´ì§€ê°€ ì—´ë ¤ìˆì„ ê²½ìš°)
            if (window.opener) {
                try {
                    window.opener.postMessage('loginSuccess', 'https://thebestys.github.io');
                    console.log("âœ… ë¶€ëª¨ ì°½ì—ê²Œ ë¡œê·¸ì¸ ì„±ê³µ ë©”ì‹œì§€ ì „ì†¡");
                } catch (e) {
                    console.warn("âš ï¸ ë¶€ëª¨ ì°½ í†µì‹  ì‹¤íŒ¨:", e);
                }
            }
            
            // 2. ë¦¬ë””ë ‰ì…˜ URLì´ ìˆìœ¼ë©´ í•´ë‹¹ í˜ì´ì§€ë¡œ, ì—†ìœ¼ë©´ ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™
            let targetUrl = 'https://thebestys.github.io/thebest/';
            
            if (redirectUrl) {
                targetUrl = redirectUrl;
                console.log("ğŸ”„ ë¦¬ë””ë ‰ì…˜ URLë¡œ ì´ë™:", targetUrl);
                
                // ìƒˆ íƒ­ì—ì„œ ë¦¬ë””ë ‰ì…˜ URL ì—´ê¸°
                window.open(targetUrl, '_blank');
                
                // í˜„ì¬ ì°½ì€ ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™
                setTimeout(() => {
                    window.location.href = 'https://thebestys.github.io/thebest/';
                }, 1500);
            } else {
                // ë°”ë¡œ ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™
                setTimeout(() => {
                    window.location.href = targetUrl;
                }, 1000);
            }
        }
        
        // ========== UI í•¨ìˆ˜ë“¤ ==========
        function showStatus(formId, message, type = 'info') {
            const statusEl = document.getElementById(`${formId}-status`);
            if (!statusEl) return;
            
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
            statusEl.style.display = 'block';
            
            if (type === 'error' || type === 'success') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }
        
        function setLoading(buttonId, isLoading) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            if (isLoading) {
                button.classList.add('loading');
                button.innerHTML = '<span class="spinner"></span>ì²˜ë¦¬ ì¤‘...';
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                button.innerHTML = buttonId === 'login-btn' ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…';
                button.disabled = false;
            }
        }
        
        function showError(fieldId, message) {
            const errorEl = document.getElementById(`${fieldId}-error`);
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.style.display = 'block';
                const inputEl = document.getElementById(fieldId);
                if (inputEl) inputEl.classList.add('error');
            }
        }
        
        function clearErrors(fieldIds) {
            fieldIds.forEach(fieldId => {
                const errorEl = document.getElementById(`${fieldId}-error`);
                if (errorEl) {
                    errorEl.style.display = 'none';
                }
                const inputEl = document.getElementById(fieldId);
                if (inputEl) inputEl.classList.remove('error');
            });
        }
        
        function showTab(tabName) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.tab-button[data-tab="${tabName}"]`).classList.add('active');
            
            // í¼ íŒ¨ë„ í™œì„±í™”
            document.querySelectorAll('.form-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${tabName}-form`).classList.add('active');
            
            // ìƒíƒœ ë©”ì‹œì§€ ì´ˆê¸°í™”
            if (tabName === 'login') {
                document.getElementById('signup-status').style.display = 'none';
                setTimeout(() => document.getElementById('email').focus(), 100);
            } else {
                document.getElementById('login-status').style.display = 'none';
                setTimeout(() => document.getElementById('signup-email').focus(), 100);
            }
        }
        
        // ========== ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜ ==========
        function validateEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }
        
        function validatePassword(password) {
            return password.length >= 6;
        }
        
        // ========== íšŒì›ê°€ì… ì²˜ë¦¬ ==========
        async function handleSignup() {
            console.log("ğŸ“ íšŒì›ê°€ì… ì‹œì‘");
            
            // ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸°
            const email = document.getElementById('signup-email').value.trim();
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            let hasError = false;
            
            if (!email) {
                showError('signup-email', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hasError = true;
            } else if (!validateEmail(email)) {
                showError('signup-email', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                hasError = true;
            }
            
            if (!username) {
                showError('username', 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hasError = true;
            }
            
            if (!password) {
                showError('signup-password', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hasError = true;
            } else if (!validatePassword(password)) {
                showError('signup-password', 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                hasError = true;
            }
            
            if (!confirmPassword) {
                showError('confirm-password', 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                hasError = true;
            } else if (password !== confirmPassword) {
                showError('confirm-password', 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                hasError = true;
            }
            
            // ì•½ê´€ ë™ì˜ í™•ì¸
            const termsAge = document.getElementById('terms-age').checked;
            const termsService = document.getElementById('terms-service').checked;
            const termsPrivacy = document.getElementById('terms-privacy').checked;
            
            if (!termsAge || !termsService || !termsPrivacy) {
                showStatus('signup', 'í•„ìˆ˜ ì•½ê´€ì— ëª¨ë‘ ë™ì˜í•´ì£¼ì„¸ìš”.', 'error');
                hasError = true;
            }
            
            if (hasError) {
                console.log("âŒ ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨");
                return;
            }
            
            // ëª¨ë“  ì—ëŸ¬ ì´ˆê¸°í™”
            clearErrors(['signup-email', 'username', 'signup-password', 'confirm-password']);
            setLoading('signup-btn', true);
            
            try {
                console.log('1. Firebase Auth ì‚¬ìš©ì ìƒì„± ì‹œë„:', email);
                
                // 1. Firebase Authì— ì‚¬ìš©ì ìƒì„±
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('âœ… 2. Firebase Auth ìƒì„± ì„±ê³µ:', user.uid);
                
                // 2. Firestoreì— ì‚¬ìš©ì ì •ë³´ ì €ì¥ (thebest ì‹œìŠ¤í…œê³¼ í˜¸í™˜ë˜ë„ë¡)
                const userData = {
                    uid: user.uid,
                    email: email,
                    name: username,
                    role: 'student',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                console.log('3. Firestore ì €ì¥ ì‹œë„:', userData);
                
                // 3. Firestoreì— ì €ì¥
                await firebase.firestore().collection('users').doc(user.uid).set(userData);
                
                console.log('âœ… 4. Firestore ì €ì¥ ì™„ë£Œ!');
                
                // 4. ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ë°œì†¡ (ì„ íƒì‚¬í•­)
                try {
                    await user.sendEmailVerification();
                    console.log('ğŸ“§ ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ë°œì†¡ë¨');
                } catch (emailError) {
                    console.warn('ì´ë©”ì¼ ì¸ì¦ ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', emailError);
                }
                
                // 5. ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                showStatus('signup', 
                    `ğŸ‰ ${username}ë‹˜, íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\në¡œê·¸ì¸ í›„ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”.`, 
                    'success'
                );
                
                // 6. í¼ ì´ˆê¸°í™”
                document.getElementById('signup-email').value = '';
                document.getElementById('username').value = '';
                document.getElementById('signup-password').value = '';
                document.getElementById('confirm-password').value = '';
                document.getElementById('terms-all').checked = false;
                document.querySelectorAll('.term').forEach(term => term.checked = false);
                
                // 7. 3ì´ˆ í›„ ë¡œê·¸ì¸ íƒ­ìœ¼ë¡œ ì „í™˜
                setTimeout(() => {
                    showTab('login');
                    document.getElementById('email').value = email;
                    showStatus('login', `${username}ë‹˜, ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”!`, 'success');
                }, 3000);
                
            } catch (error) {
                console.error('âŒ íšŒì›ê°€ì… ì‹¤íŒ¨:', error);
                
                let errorMessage = 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                switch(error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                        showError('signup-email', errorMessage);
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤. ë” ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.';
                        showError('signup-password', errorMessage);
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
                        showError('signup-email', errorMessage);
                        break;
                    case 'auth/operation-not-allowed':
                        errorMessage = 'ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ íšŒì›ê°€ì…ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.';
                        showStatus('signup', errorMessage, 'error');
                        break;
                    default:
                        showStatus('signup', `${errorMessage}: ${error.message}`, 'error');
                }
                
            } finally {
                setLoading('signup-btn', false);
            }
        }
        
        // ========== ë¡œê·¸ì¸ ì²˜ë¦¬ ==========
        async function handleLogin() {
            console.log("ğŸ” ë¡œê·¸ì¸ ì‹œì‘");
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            
            // ìœ íš¨ì„± ê²€ì‚¬
            if (!email) {
                showError('email', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (!validateEmail(email)) {
                showError('email', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }
            
            if (!password) {
                showError('password', 'ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            clearErrors(['email', 'password']);
            setLoading('login-btn', true);
            
            try {
                console.log('ë¡œê·¸ì¸ ì‹œë„:', email);
                
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                console.log('âœ… ë¡œê·¸ì¸ ì„±ê³µ:', user.uid);
                
                // ì„±ê³µ ë©”ì‹œì§€
                showStatus('login', `${user.email}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤! ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`, 'success');
                
                // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.getElementById('email').value = '';
                document.getElementById('password').value = '';
                
                // 1.5ì´ˆ í›„ ë©”ì¸í˜ì´ì§€ë¡œ ì´ë™
                setTimeout(() => {
                    redirectToMainPage();
                }, 1500);
                
            } catch (error) {
                console.error('âŒ ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
                
                let errorMessage = 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                
                switch(error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.';
                        showError('email', errorMessage);
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.';
                        showError('password', errorMessage);
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
                        showError('email', errorMessage);
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'ì‚¬ìš©ì´ ì¤‘ì§€ëœ ê³„ì •ì…ë‹ˆë‹¤.';
                        showError('email', errorMessage);
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ë„ˆë¬´ ë§ì€ ì‹œë„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        showStatus('login', errorMessage, 'error');
                        break;
                    default:
                        showStatus('login', `${errorMessage}: ${error.message}`, 'error');
                }
                
            } finally {
                setLoading('login-btn', false);
            }
        }
        
        // ========== ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ==========
        async function handleForgotPassword() {
            const email = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì¬ì„¤ì •í•  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:');
            
            if (!email) return;
            
            if (!validateEmail(email)) {
                alert('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                await firebase.auth().sendPasswordResetEmail(email);
                alert(`ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë©”ì¼ì„ ${email}ë¡œ ë°œì†¡í–ˆìŠµë‹ˆë‹¤.\nì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.`);
            } catch (error) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ì‹¤íŒ¨:', error);
                alert('ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ ì£¼ì†Œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }
        
        // ========== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ==========
        function setupEventListeners() {
            console.log("ğŸ”— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì‹œì‘");
            
            // íƒ­ ë²„íŠ¼
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
            
            // íšŒì›ê°€ì… ë²„íŠ¼
            const signupBtn = document.getElementById('signup-btn');
            if (signupBtn) {
                signupBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    console.log("âœ… íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ë¨!");
                    await handleSignup();
                });
            }
            
            // ë¡œê·¸ì¸ ë²„íŠ¼
            const loginBtn = document.getElementById('login-btn');
            if (loginBtn) {
                loginBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    console.log("âœ… ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ë¨!");
                    await handleLogin();
                });
            }
            
            // ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
            const forgotPasswordBtn = document.getElementById('forgot-password');
            if (forgotPasswordBtn) {
                forgotPasswordBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    handleForgotPassword();
                });
            }
            
            // íƒ­ ì „í™˜ ë§í¬
            document.querySelectorAll('a[data-tab]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabName = link.getAttribute('data-tab');
                    showTab(tabName);
                });
            });
            
            // ì•½ê´€ ì „ì²´ ë™ì˜
            const termsAll = document.getElementById('terms-all');
            if (termsAll) {
                termsAll.addEventListener('click', () => {
                    const isChecked = termsAll.checked;
                    document.querySelectorAll('.term').forEach(term => {
                        term.checked = isChecked;
                    });
                });
            }
            
            // ì•½ê´€ ë³´ê¸°
            document.getElementById('view-service-terms')?.addEventListener('click', (e) => {
                e.preventDefault();
                alert('ë”ë² ìŠ¤íŠ¸ì–´í•™ì› ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.');
            });
            
            document.getElementById('view-privacy-terms')?.addEventListener('click', (e) => {
                e.preventDefault();
                alert('ë”ë² ìŠ¤íŠ¸ì–´í•™ì› ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ì•½ê´€ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.');
            });
            
            // ì—”í„° í‚¤ë¡œ í¼ ì œì¶œ
            document.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const activePanel = document.querySelector('.form-panel.active');
                    if (activePanel.id === 'login-form') {
                        e.preventDefault();
                        handleLogin();
                    } else if (activePanel.id === 'signup-form') {
                        e.preventDefault();
                        handleSignup();
                    }
                }
            });
            
            console.log("âœ… ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ì™„ë£Œ");
        }
    </script>
</body>
</html>
